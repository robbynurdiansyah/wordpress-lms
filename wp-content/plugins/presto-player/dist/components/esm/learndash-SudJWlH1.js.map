{"version":3,"file":"learndash-SudJWlH1.js","sources":["src/components/core/player/integrations/learndash.js"],"sourcesContent":["import { resumeProgress } from '../functions/save-time';\n\nexport default player => {\n  if (typeof learndash_video_data === 'undefined' || learndash_video_data?.videos_found_provider !== 'presto') {\n    return;\n  }\n\n  resumeProgress(player, true); // maybe resume progress\n\n  // Learndash has this logic in a shitty method on their php class\n  // we have to fake it here since we don't have access to it\n  window.learndash_video_data.videos_auto_complete = prestoPlayer?.learndash?.lesson_video_auto_complete === 'on';\n  window.learndash_video_data.videos_hide_complete_button = 'AFTER' === learndash_video_data?.videos_shown && prestoPlayer?.learndash?.lesson_video_hide_complete_button === 'on';\n  window.learndash_video_data.videos_auto_complete_delay = prestoPlayer?.learndash?.lesson_video_auto_complete_delay;\n  window.learndash_video_data.videos_auto_complete_delay_message = prestoPlayer?.learndash?.videos_auto_complete_delay_message;\n\n  // Temporarily set the video track path to '/' to set the cookie globally\n  window.learndash_video_data.video_track_path = '/';\n\n   // Set learndash video players\n   jQuery(function () {\n    if (learndash_video_data.video_debug === '1') {\n      console.log('PRESTO: init');\n    }\n\n    if (document.querySelectorAll('presto-player[data-video-progression=\"true\"][data-video-provider=\"' + learndash_video_data.videos_found_provider + '\"]').length) {\n      if (learndash_video_data.video_debug === '1') {\n        console.log('PRESTO: calling LearnDash_disable_assets(true)');\n      }\n\n      // Disable learndash assets and watch players.\n      LearnDash_disable_assets(true);\n      LearnDash_watchPlayers();\n\n      // Go through all the <presto-player> instances\n      document\n        .querySelectorAll('presto-player[data-video-progression=\"true\"][data-video-provider=\"' + learndash_video_data.videos_found_provider + '\"]')\n        .forEach(function (element, index) {\n          console.log({element});\n          var element_key = 'presto-player__wrapper-player-' + index;\n          var element_id = element.getAttribute('id');\n\n          if (typeof element_id === 'undefined' || element_id == '') {\n            element_id = element_key;\n            element.setAttribute('id', element_id);\n          }\n\n          ld_video_players[element_key] = {};\n          ld_video_players[element_key]['player_key'] = element_key;\n          ld_video_players[element_key]['player_type'] = learndash_video_data.videos_found_provider;\n          ld_video_players[element_key]['player_id'] = element_id;\n          ld_video_players[element_key]['player_wrapper'] = element.closest('presto-player');\n          if (typeof ld_video_players[element_key]['player_wrapper'] !== 'undefined') {\n            ld_video_players[element_key]['player_cookie_key'] = ld_video_players[element_key]['player_wrapper'].getAttribute('data-video-cookie-key');\n          } else {\n            ld_video_players[element_key]['player_cookie_key'] = '';\n          }\n          ld_video_players[element_key]['player_cookie_values'] = LearnDash_Video_Progress_initSettings(ld_video_players[element_key]);\n\n          // Check if video has been completed already.\n          // If yes, enable the assets back and end watch players function.\n          // If no, then apply all the filters and performs the actions again.\n          if (LearnDash_Video_Progress_getSetting(ld_video_players[element_key], 'video_state') === 'complete') {\n            LearnDash_disable_assets(false);\n            LearnDash_watchPlayersEnd();\n          } else {\n            // Player Seeked.\n            wp.hooks.addAction('presto.playerTimeUpdate', 'presto-player', player => {\n              if (learndash_video_data.video_debug === '1') {\n                console.log('PRESTO: Video is playing');\n              }\n              LearnDash_Video_Progress_setSetting(ld_video_players[element_key], 'video_duration', player.duration);\n              LearnDash_Video_Progress_setSetting(ld_video_players[element_key], 'video_time', player.currentTime);\n\n              if (player.duration && player.duration === player.currentTime) {\n                LearnDash_Video_Progress_setSetting(ld_video_players[element_key], 'video_state', 'complete');\n\n                if (learndash_video_data.video_debug === '1') {\n                  console.log('PRESTO: calling LearnDash_disable_assets(false)');\n                }\n                LearnDash_disable_assets(false);\n\n                // Stop watching players.\n                LearnDash_watchPlayersEnd();\n              }\n            });\n\n            // Player Playing.\n            wp.hooks.addAction('presto.playerPlaying', 'presto-player', player => {\n              if (learndash_video_data.video_debug === '1') {\n                console.log('PRESTO: Video is playing');\n              }\n              LearnDash_Video_Progress_setSetting(ld_video_players[element_key], 'video_duration', player.duration);\n              LearnDash_Video_Progress_setSetting(ld_video_players[element_key], 'video_time', player.currentTime);\n              LearnDash_Video_Progress_setSetting(ld_video_players[element_key], 'video_state', 'play');\n            });\n\n            // Player Paused.\n            wp.hooks.addAction('presto.playerPause', 'presto-player', player => {\n              if (learndash_video_data.video_debug === '1') {\n                console.log('PRESTO: Video is paused');\n              }\n              LearnDash_Video_Progress_setSetting(ld_video_players[element_key], 'video_time', player.currentTime);\n              console.log(player.duration);\n              console.log(player.currentTime);\n              LearnDash_Video_Progress_setSetting(ld_video_players[element_key], 'video_state', 'pause');\n            });\n\n            // Player Ended.\n            wp.hooks.addAction('presto.playerEnded', 'presto-player', player => {\n              if (learndash_video_data.video_debug === '1') {\n                console.log('PRESTO: video ended');\n              }\n\n              if (learndash_video_data.video_debug === '1') {\n                console.log(\"PRESTO: setting 'video_state' to 'complete'\");\n              }\n              LearnDash_Video_Progress_setSetting(ld_video_players[element_key], 'video_time', player.currentTime);\n              LearnDash_Video_Progress_setSetting(ld_video_players[element_key], 'video_state', 'complete');\n\n              if (learndash_video_data.video_debug === '1') {\n                console.log('PRESTO: calling LearnDash_disable_assets(false)');\n              }\n              LearnDash_disable_assets(false);\n\n              // Stop watching players.\n              LearnDash_watchPlayersEnd();\n            });\n          }\n        });\n    }\n  });\n};\n"],"names":[],"mappings":"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"}